// Generated by CoffeeScript 1.6.3
(function(){window.TimeSeriesGraph=function(){function u(e,t,n,r){this.data=e;this.container=t;this.width=n;this.height=r}var e,t,n,r,i,s,o;i=300;n=100;t=d3.time.format("%Y-%m-%d %H:%M:%S");e=d3.scale.category10();s=d3.time.scale();o=d3.scale.linear();r=d3.svg.line();u.ts_stats=function(e,t){var n;return n={mean:d3.mean(e,t),sd:Math.sqrt(science.stats.variance(e.map(function(e){return e.response}))),min:d3.min(e,t),max:d3.max(e,t),count:e.length,raw:e}};u.ts_roll=function(e){return this.ts_stats(e.map(function(e){return{timestamp:e.timestamp,response:e.response}}),d3.functor(function(e){return e.response}))};u.pointify=function(e){return{x:s(e.timestamp),y:o(e.response)}};u.aggregate=function(e,n){var r,i,s,o;s=0;i=d3.nest().key(function(e){return t(e.timestamp)}).rollup(function(e){return d3.mean(e.map(function(e){return e.response}))}).entries(e);i.forEach(function(e){e.timestamp=t.parse(e.key);e.response=+e.values;return e});o=i[0].timestamp;r=d3.nest().key(function(e){return Math.floor(s++/n)}).rollup(function(e){return d3.mean(e.map(function(e){return e.response}))}).entries(i);r.forEach(function(e){var t;t=o.getTime()+parseInt(e.key)*1e3*n;e.timestamp=new Date(t);e.response=+e.values;return e});return r};u.graph_data=function(t,a){var f,l,c,h,p,d;l=t.sort(function(e,t){return d3.ascending(+e.timestamp,+t.timestamp)});l.forEach(function(e){e.timestamp=new Date(+e.timestamp);return e.response=+e.response});f=d3.nest().key(function(e){return e.name}).rollup(function(e){return u.ts_roll(e)}).entries(l);d=d3.set(l.map(function(e){return e.name})).values();s.domain(d3.extent(l.map(function(e){return e.timestamp}))).range([0,i]);r.x(function(e){return e.x}).y(function(e){return e.y}).interpolate("monotone");p=d3.functor(this.pointify);c=l.map(p);h=d3.select("body").append("svg");h.attr("width",i).attr("height",n);h.selectAll("path").data(f[3]).enter().append("path").attr("d",function(e){o.domain([0,d3.max(l.map(function(e){return e.response}))]).range([n,0]);return r(u.aggregate(e.values.raw,a).map(u.pointify))}).style("stroke",function(t,n){return e(n)}).style("stroke-width","1px").style("fill","none");return f};return u}()}).call(this);