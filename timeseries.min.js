// Generated by CoffeeScript 1.6.3
(function(){window.TimeSeriesGraph=function(){function o(e,t,n,r){this.data=e;this.container=t;this.width=n;this.height=r}var e,t,n,r,i,s;r=300;n=100;t=d3.time.format("%Y-%m-%d %H:%M:%S");e=d3.scale.category10();i=d3.time.scale();s=d3.scale.linear();o.line=d3.svg.line();o.ts_stats=function(e,t){var n;return n={mean:d3.mean(e,t),sd:Math.sqrt(science.stats.variance(e.map(function(e){return e.response}))),min:d3.min(e,t),max:d3.max(e,t),count:e.length,raw:e}};o.ts_roll=function(e){return this.ts_stats(e.map(function(e){return{timestamp:e.timestamp,response:e.response}}),d3.functor(function(e){return e.response}))};o.pointify=function(e){return{x:i(e.timestamp),y:s(e.response)}};o.aggregate=function(e,n){var r,i,s,o;s=0;i=d3.nest().key(function(e){return t(e.timestamp)}).rollup(function(e){return d3.mean(e.map(function(e){return e.response}))}).entries(e);i.forEach(function(e){e.timestamp=t.parse(e.key);e.response=+e.values;return e});o=i[0].timestamp;r=d3.nest().key(function(e){return Math.floor(s++/n)}).rollup(function(e){return d3.mean(e.map(function(e){return e.response}))}).entries(i);r.forEach(function(e){var t;t=o.getTime()+parseInt(e.key)*1e3*n;e.timestamp=new Date(t);e.response=+e.values;return e});return r};o.graph_data=function(e,t){var u,a,f,l,c;a=e.sort(function(e,t){return d3.ascending(+e.timestamp,+t.timestamp)});a.forEach(function(e){e.timestamp=new Date(+e.timestamp);return e.response=+e.response});u=d3.nest().key(function(e){return e.name}).rollup(function(e){return o.ts_roll(e)}).entries(a);c=d3.set(a.map(function(e){return e.name})).values();i.domain(d3.extent(a.map(function(e){return e.timestamp}))).range([10,r-10]);this.line.x(function(e){return e.x}).y(function(e){return e.y}).interpolate("monotone");l=d3.functor(this.pointify);f=a.map(l);u.forEach(function(e,i){var u;u=d3.select("#graph").append("svg");u.attr("width",r).attr("height",n);u.append("text").attr("x",r).attr("y",10).text(function(t){return e.key});return u.append("path").datum(e).attr("d",function(e){var r;r=o.aggregate(e.values.raw,t);s.domain([0,d3.max(r.map(function(e){return e.response}))]).range([n,10]);return o.line(r.map(o.pointify))}).attr("class","mosaic")});return u};return o}()}).call(this);